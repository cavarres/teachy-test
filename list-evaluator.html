<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>List Evaluator - Teachy</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="evaluator.css">
</head>
<body>
    <div class="container">
        <!-- Selection Page -->
        <div id="selectionPage" class="selection-page">
            <div class="selection-card">
                <h1>List Evaluator</h1>
                <p class="selection-subtitle">Please enter your name and select the subject to begin evaluating question lists.</p>
                
                <div class="selection-form">
                    <div class="form-group">
                        <label for="userNameInput">Your Name:</label>
                        <input type="text" id="userNameInput" class="form-control" placeholder="Enter your name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="subjectSelect">Subject:</label>
                        <select id="subjectSelect" class="form-control">
                            <option value="">-- Select Subject --</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="languageSelect">Language:</label>
                        <select id="languageSelect" class="form-control">
                            <option value="BOTH">Both (English & Portuguese)</option>
                            <option value="English">English</option>
                            <option value="Portuguese">Portuguese</option>
                        </select>
                    </div>
                    
                    <button id="startEvaluatorBtn" class="btn btn-primary btn-block" disabled>Next →</button>
                </div>
            </div>
        </div>

        <!-- Evaluator Interface -->
        <div id="evaluatorPage" class="list-evaluator-page" style="display: none;">
            <header>
                <h1>List Evaluator</h1>
                <div class="header-controls">
                    <span class="selection-info">Subject: <strong id="selectedSubjectDisplay"></strong> | Language: <strong id="selectedLanguageDisplay"></strong></span>
                    <button id="backToSelectionBtn" class="btn btn-secondary">← Back to Subject Selection</button>
                    <button id="exportCsvBtn" class="btn btn-primary" disabled>Export to CSV</button>
                </div>
            </header>

            <div id="loadingMessage" class="loading-message">
                <p>Loading questions...</p>
            </div>

            <div id="evaluatorInterface" class="evaluator-interface" style="display: none;">

            <!-- Question Navigation -->
            <div class="question-navigation">
                <button id="prevBtn" class="btn btn-nav">← Previous</button>
                <div class="question-counter">
                    <span id="questionCounter">Question 1 of 1</span>
                </div>
                <button id="nextBtn" class="btn btn-nav">Next →</button>
            </div>

            <div class="main-content">
                <!-- Left Panel: Questions List -->
                <div class="question-panel">
                    <div class="question-header">
                        <h2 id="listHeading">List —</h2>
                        <div class="question-meta">
                            <div class="meta-row-primary">
                                <div class="meta-item"><strong>Discipline:</strong> <span id="listDiscipline">—</span></div>
                                <div class="meta-item"><strong>Category:</strong> <span id="listCategory">—</span></div>
                            </div>
                            <div class="meta-row-secondary">
                                <span class="meta-item"><strong>Grade:</strong> <span id="listGrade">—</span></span>
                                <span class="meta-item"><strong>Difficulty:</strong> <span id="listDifficulty">—</span></span>
                                <span class="meta-item"><strong>Requested:</strong> <span id="listRequestSummary">—</span></span>
                                <span class="meta-item"><strong>Locale:</strong> <span id="listRequestLocale">—</span></span>
                            </div>
                        </div>
                    </div>
                    <div class="questions-list-container">
                        <div id="questionsList" class="questions-list"></div>
                    </div>
                </div>

                <!-- Right Panel: Evaluation Criteria -->
                <div class="evaluation-panel">
                    <h2>List Evaluation</h2>
                    
                    <div class="evaluation-section">
                        <h3>Category 1: Teacher Input Alignment</h3>
                        
                        <div class="form-group teacher-input-compliance-group">
                            <label>
                                1. Teacher Input Compliance (0-3)
                                <span class="info-icon" data-criterion="teacherInputCompliance">ℹ️</span>
                            </label>
                            <div class="criteria-hint">Does the list meet the teacher's explicit technical specifications? Select Yes or No for each (1 point each).</div>
                            <div class="compliance-sub-row">
                                <span class="compliance-label">Correct language — questions are in the language specified by the teacher</span>
                                <div class="score-button-group score-button-group-yesno">
                                    <button type="button" class="btn-score btn-yes-no" data-value="0" data-field="teacherInputCompliance_language">No</button>
                                    <button type="button" class="btn-score btn-yes-no" data-value="1" data-field="teacherInputCompliance_language">Yes</button>
                                </div>
                            </div>
                            <div class="compliance-sub-row">
                                <span class="compliance-label">Correct total number of questions — matches the teacher's request</span>
                                <div class="score-button-group score-button-group-yesno">
                                    <button type="button" class="btn-score btn-yes-no" data-value="0" data-field="teacherInputCompliance_count">No</button>
                                    <button type="button" class="btn-score btn-yes-no" data-value="1" data-field="teacherInputCompliance_count">Yes</button>
                                </div>
                            </div>
                            <div class="compliance-sub-row">
                                <span class="compliance-label">Correct question type distribution — MCQ only / Open-ended only / Both as selected</span>
                                <div class="score-button-group score-button-group-yesno">
                                    <button type="button" class="btn-score btn-yes-no" data-value="0" data-field="teacherInputCompliance_type">No</button>
                                    <button type="button" class="btn-score btn-yes-no" data-value="1" data-field="teacherInputCompliance_type">Yes</button>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>
                                2. Topic & Materials Alignment (0-2)
                                <span class="info-icon" data-criterion="topicMaterialsAlignment">ℹ️</span>
                            </label>
                            <div class="criteria-hint">Does the list address the topic requested by the teacher and appropriately incorporate any uploaded materials?</div>
                            <div class="score-button-group">
                                <button type="button" class="btn-score" data-value="0" data-field="topicMaterialsAlignment">0</button>
                                <button type="button" class="btn-score" data-value="1" data-field="topicMaterialsAlignment">1</button>
                                <button type="button" class="btn-score" data-value="2" data-field="topicMaterialsAlignment">2</button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>
                                3. Grade-Level & Difficulty Alignment (0-2)
                                <span class="info-icon" data-criterion="gradeLevelDifficulty">ℹ️</span>
                            </label>
                            <div class="criteria-hint">Is the list consistently appropriate for the target grade level and specified difficulty in vocabulary, complexity, and cognitive expectations?</div>
                            <div class="score-button-group">
                                <button type="button" class="btn-score" data-value="0" data-field="gradeLevelDifficulty">0</button>
                                <button type="button" class="btn-score" data-value="1" data-field="gradeLevelDifficulty">1</button>
                                <button type="button" class="btn-score" data-value="2" data-field="gradeLevelDifficulty">2</button>
                            </div>
                        </div>
                    </div>

                    <div class="evaluation-section">
                        <h3>Category 2: Pedagogical Fundamentals</h3>
                        
                        <div class="form-group">
                            <label>
                                4. Uniqueness & Diversity of Questions (0-2)
                                <span class="info-icon" data-criterion="uniqueness">ℹ️</span>
                            </label>
                            <div class="criteria-hint">Does the list avoid unintended redundancy and show meaningful variation in how the target skill(s) are assessed?</div>
                            <div class="score-button-group">
                                <button type="button" class="btn-score" data-value="0" data-field="uniqueness">0</button>
                                <button type="button" class="btn-score" data-value="1" data-field="uniqueness">1</button>
                                <button type="button" class="btn-score" data-value="2" data-field="uniqueness">2</button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>
                                5. Topic Coverage (0-2)
                                <span class="info-icon" data-criterion="topicCoverage">ℹ️</span>
                            </label>
                            <div class="criteria-hint">Does the list provide appropriate coverage of the content domain within the scope defined by the teacher?</div>
                            <div class="score-button-group">
                                <button type="button" class="btn-score" data-value="0" data-field="topicCoverage">0</button>
                                <button type="button" class="btn-score" data-value="1" data-field="topicCoverage">1</button>
                                <button type="button" class="btn-score" data-value="2" data-field="topicCoverage">2</button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>
                                6. Cognitive Level Diversity (0-2)
                                <span class="info-icon" data-criterion="cognitiveDiversity">ℹ️</span>
                            </label>
                            <div class="criteria-hint">Does the list include appropriate variety across different thinking levels?</div>
                            <div class="score-button-group">
                                <button type="button" class="btn-score" data-value="0" data-field="cognitiveDiversity">0</button>
                                <button type="button" class="btn-score" data-value="1" data-field="cognitiveDiversity">1</button>
                                <button type="button" class="btn-score" data-value="2" data-field="cognitiveDiversity">2</button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>
                                7. Difficulty Progression (0-2)
                                <span class="info-icon" data-criterion="difficultyProgression">ℹ️</span>
                            </label>
                            <div class="criteria-hint">Is the list ordered to avoid unnecessary difficulty spikes and support a coherent progression for students?</div>
                            <div class="score-button-group">
                                <button type="button" class="btn-score" data-value="0" data-field="difficultyProgression">0</button>
                                <button type="button" class="btn-score" data-value="1" data-field="difficultyProgression">1</button>
                                <button type="button" class="btn-score" data-value="2" data-field="difficultyProgression">2</button>
                            </div>
                        </div>
                    </div>

                    <div class="evaluation-section">
                        <h3>Category 3: Assessment Design</h3>
                        
                        <div class="form-group">
                            <label>
                                8. Answer Leakage Prevention (0-2)
                                <span class="info-icon" data-criterion="answerLeakage">ℹ️</span>
                            </label>
                            <div class="criteria-hint">Does the list avoid questions that inadvertently reveal answers to other questions?</div>
                            <div class="score-button-group">
                                <button type="button" class="btn-score" data-value="0" data-field="answerLeakage">0</button>
                                <button type="button" class="btn-score" data-value="1" data-field="answerLeakage">1</button>
                                <button type="button" class="btn-score" data-value="2" data-field="answerLeakage">2</button>
                            </div>
                        </div>
                    </div>

                    <div class="evaluation-section">
                        <h3>Additional Information</h3>
                        
                        <div class="form-group">
                            <label for="summary">Overall Summary:</label>
                            <textarea id="summary" class="form-control" rows="4" placeholder="Overall assessment of the question list as a complete assessment..."></textarea>
                        </div>
                    </div>

                    <div class="evaluation-summary">
                        <div class="score-display">
                            <strong>Total Score:</strong> <span id="totalScore">0</span> / 17
                        </div>
                        <div class="score-display">
                            <strong>Percentage:</strong> <span id="percentageScore">0</span>%
                        </div>
                        <div class="status-display" id="statusDisplay"></div>
                    </div>

                    <button id="saveEvaluationBtn" class="btn btn-primary btn-block">Save and go to next question</button>
                </div>
            </div>
        </div>
        </div>
    </div>

    <!-- Info Tooltip Modal -->
    <div id="infoModal" class="info-modal" style="display: none;">
        <div class="info-modal-content">
            <div class="info-modal-header">
                <h3 id="infoModalTitle">Scoring Guide</h3>
                <button class="info-modal-close" id="closeInfoModal">&times;</button>
            </div>
            <div class="info-modal-body" id="infoModalBody"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <script src="list-evaluator.js"></script>
</body>
</html>
