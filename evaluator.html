<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Question Evaluator - Teachy</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="evaluator.css">
</head>
<body>
    <div class="container">
        <!-- Selection Page -->
        <div id="selectionPage" class="selection-page">
            <div class="selection-card">
                <h1>Question Evaluator</h1>
                <p class="selection-subtitle">Please enter your name and select the subject to begin evaluating questions.</p>
                
                <div class="selection-form">
                    <div class="form-group">
                        <label for="userNameInput">Your Name:</label>
                        <input type="text" id="userNameInput" class="form-control" placeholder="Enter your name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="subjectSelect">Subject:</label>
                        <select id="subjectSelect" class="form-control">
                            <option value="">-- Select Subject --</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="languageSelect">Language:</label>
                        <select id="languageSelect" class="form-control">
                            <option value="BOTH">Both (English & Portuguese)</option>
                            <option value="English">English</option>
                            <option value="Portuguese">Portuguese</option>
                        </select>
                    </div>
                    
                    <button id="startEvaluatorBtn" class="btn btn-primary btn-block" disabled>Next →</button>
                </div>
            </div>
        </div>

        <!-- Evaluator Interface -->
        <div id="evaluatorPage" style="display: none;">
            <header>
                <h1>Question Evaluator</h1>
                <div class="header-controls">
                    <span class="selection-info">Subject: <strong id="selectedSubjectDisplay"></strong> | Language: <strong id="selectedLanguageDisplay"></strong></span>
                    <button id="backToSelectionBtn" class="btn btn-secondary">← Back to Subject Selection</button>
                    <button id="exportCsvBtn" class="btn btn-primary" disabled>Export to CSV</button>
                </div>
            </header>


            <div id="loadingMessage" class="loading-message">
                <p>Loading questions...</p>
            </div>

            <div id="evaluatorInterface" class="evaluator-interface" style="display: none;">
            <div class="question-navigation">
                <button id="prevBtn" class="btn btn-nav">← Previous</button>
                <div class="question-counter">
                    <span id="questionCounter">Question 1 of 1</span>
                    <input type="number" id="jumpToInput" placeholder="Jump to..." min="1" style="width: 80px; margin-left: 10px;">
                    <button id="jumpToBtn" class="btn btn-small">Go</button>
                </div>
                <button id="nextBtn" class="btn btn-nav">Next →</button>
            </div>

            <div class="main-content">
                <div class="question-panel">
                    <div class="question-header">
                        <h2>Question <span id="questionId"></span></h2>
                        <div class="question-meta">
                            <div class="meta-row-primary">
                                <div class="meta-item"><strong>Discipline:</strong> <span id="questionDiscipline"></span></div>
                                <div class="meta-item"><strong>Category:</strong> <span id="questionCategory"></span></div>
                            </div>
                            <div class="meta-row-secondary">
                                <span class="meta-item"><strong>Grade:</strong> <span id="questionGrade"></span></span>
                                <span class="meta-item"><strong>Difficulty:</strong> <span id="questionDifficulty"></span></span>
                                <span class="meta-item"><strong>Type:</strong> <span id="questionType"></span></span>
                            </div>
                        </div>
                    </div>

                    <div class="question-content">
                        <div class="section">
                            <h3>Statement</h3>
                            <div id="questionStatement" class="content-box"></div>
                        </div>

                        <div id="mcqOptionsSection" class="section" style="display: none;">
                            <h3>Answer Options</h3>
                            <div id="mcqOptions" class="content-box"></div>
                        </div>

                        <div class="section">
                            <h3>Solution/Explanation</h3>
                            <div id="questionSolution" class="content-box"></div>
                        </div>
                    </div>
                </div>

                <div class="evaluation-panel">
                    <h2>Evaluation</h2>
                    
                    <div class="evaluation-section">
                        <h3>Phase 1: Gate-Keeping Criteria</h3>
                        
                        <div class="form-group">
                            <label>Completeness Check</label>
                            <div class="criteria-hint">Is the question package complete? Required: statement, answer key, explanation. For MCQ: 4-5 options. For Open-ended: model answer/rubric. FAIL if missing components, truncated content, broken formatting, or placeholders.</div>
                            <div class="button-group">
                                <button type="button" class="btn-toggle" data-value="PASS" data-field="completeness">PASS</button>
                                <button type="button" class="btn-toggle" data-value="FAIL" data-field="completeness">FAIL</button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Factual Correctness Check</label>
                            <div class="criteria-hint">Is the question factually and conceptually correct? FAIL if contains errors, wrong answer key, logical contradictions, or multiple defensible correct answers.</div>
                            <div class="button-group">
                                <button type="button" class="btn-toggle" data-value="PASS" data-field="factualCorrectness">PASS</button>
                                <button type="button" class="btn-toggle" data-value="FAIL" data-field="factualCorrectness">FAIL</button>
                            </div>
                        </div>
                    </div>

                    <div class="evaluation-section" id="phase2Section">
                        <h3>Phase 2: Quality Assessment</h3>
                        
                        <div class="form-group">
                            <label>
                                Prompt Quality (0-2)
                                <span class="info-icon" data-criterion="promptQuality">ℹ️</span>
                            </label>
                            <div class="criteria-hint">Is the question prompt well-crafted, clear, and appropriately scoped?</div>
                            <div class="score-button-group">
                                <button type="button" class="btn-score" data-value="0" data-field="promptQuality">0</button>
                                <button type="button" class="btn-score" data-value="1" data-field="promptQuality">1</button>
                                <button type="button" class="btn-score" data-value="2" data-field="promptQuality">2</button>
                            </div>
                        </div>

                        <div id="mcqQualityGroup" class="form-group" style="display: none;">
                            <label>
                                MCQ Quality (0-2) [MCQ only]
                                <span class="info-icon" data-criterion="mcqQuality">ℹ️</span>
                            </label>
                            <div class="criteria-hint">How good are the distractors AND how well are they explained?</div>
                            <div class="score-button-group">
                                <button type="button" class="btn-score" data-value="0" data-field="mcqQuality">0</button>
                                <button type="button" class="btn-score" data-value="1" data-field="mcqQuality">1</button>
                                <button type="button" class="btn-score" data-value="2" data-field="mcqQuality">2</button>
                            </div>
                        </div>

                        <div id="openEndedQualityGroup" class="form-group" style="display: none;">
                            <label>
                                Open-ended Quality (0-2) [Open-ended only]
                                <span class="info-icon" data-criterion="openEndedQuality">ℹ️</span>
                            </label>
                            <div class="criteria-hint">Does the model answer or rubric provide clear, actionable guidance?</div>
                            <div class="score-button-group">
                                <button type="button" class="btn-score" data-value="0" data-field="openEndedQuality">0</button>
                                <button type="button" class="btn-score" data-value="1" data-field="openEndedQuality">1</button>
                                <button type="button" class="btn-score" data-value="2" data-field="openEndedQuality">2</button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>
                                Cognitive Demand Appropriateness (0-2)
                                <span class="info-icon" data-criterion="cognitiveDemand">ℹ️</span>
                            </label>
                            <div class="criteria-hint">Is this question correctly categorized for the assigned grade and difficulty?</div>
                            <div class="score-button-group">
                                <button type="button" class="btn-score" data-value="0" data-field="cognitiveDemand">0</button>
                                <button type="button" class="btn-score" data-value="1" data-field="cognitiveDemand">1</button>
                                <button type="button" class="btn-score" data-value="2" data-field="cognitiveDemand">2</button>
                            </div>
                        </div>
                    </div>

                    <div class="evaluation-section">
                        <h3>Additional Information</h3>
                        
                        <div class="form-group">
                            <label for="reasoning">Reasoning:</label>
                            <textarea id="reasoning" class="form-control" rows="4" placeholder="Brief explanation of your overall assessment..."></textarea>
                        </div>
                    </div>

                    <div class="evaluation-summary">
                        <div class="score-display">
                            <strong>Total Score:</strong> <span id="totalScore">0</span> / 6
                        </div>
                        <div class="status-display" id="statusDisplay"></div>
                    </div>

                    <button id="saveEvaluationBtn" class="btn btn-primary btn-block">Go to next question</button>
                </div>
            </div>

            <div class="progress-indicator">
                <strong>Progress:</strong> <span id="progressText">0 of 0 evaluated</span>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
            </div>
        </div>
        </div>
    </div>

    <!-- Info Tooltip Modal -->
    <div id="infoModal" class="info-modal" style="display: none;">
        <div class="info-modal-content">
            <div class="info-modal-header">
                <h3 id="infoModalTitle">Scoring Guide</h3>
                <button class="info-modal-close" id="closeInfoModal">&times;</button>
            </div>
            <div class="info-modal-body" id="infoModalBody"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <script src="evaluator.js"></script>
</body>
</html>
